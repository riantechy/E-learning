{% extends "admin/base_site.html" %}
{% load i18n %}

{% block content %}
<div id="content-main">
    <h1>{% trans "Bulk Update Module Progress" %}</h1>
    
    {% if request.session.bulk_operation_errors %}
    <div class="errornote">
        <h3>{% trans "Errors occurred during processing:" %}</h3>
        <ul>
            {% for error in request.session.bulk_operation_errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div class="module">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="form-row">
                <label for="excel_file">{% trans "Excel File:" %}</label>
                <input type="file" name="excel_file" accept=".xlsx, .xls" required>
                <p class="help">{% trans "Upload an Excel file with the specific format: columns for No., NAME, EMAIL ADDRESS, PHONE NUMBER, followed by module ID columns" %}</p>
            </div>

            <div class="submit-row">
                <input type="submit" value="{% trans 'Update Module Progress' %}" class="default">
                <a href="{% url 'admin:courses_moduleprogress_changelist' %}" class="button">{% trans 'Cancel' %}</a>
            </div>
        </form>
    </div>

    <div class="module">
        <h2>{% trans "Excel File Format" %}</h2>
        <p>{% trans "Your Excel file should have this structure:" %}</p>
        <table>
            <thead>
                <tr>
                    <th>{% trans "Column" %}</th>
                    <th>{% trans "Description" %}</th>
                    <th>{% trans "Required" %}</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>No.</code></td>
                    <td>{% trans "Serial number" %}</td>
                    <td>{% trans "Yes" %}</td>
                </tr>
                <tr>
                    <td><code>NAME</code></td>
                    <td>{% trans "User's full name" %}</td>
                    <td>{% trans "Yes" %}</td>
                </tr>
                <tr>
                    <td><code>EMAIL ADDRESS</code></td>
                    <td>{% trans "User's email address" %}</td>
                    <td>{% trans "Yes" %}</td>
                </tr>
                <tr>
                    <td><code>PHONE NUMBER</code></td>
                    <td>{% trans "User's phone number" %}</td>
                    <td>{% trans "Yes" %}</td>
                </tr>
                <tr>
                    <td><code>[Module UUID]</code></td>
                    <td>{% trans "Module ID columns with values like 'completed YYYY-MM-DD'" %}</td>
                    <td>{% trans "Conditional" %}</td>
                </tr>
            </tbody>
        </table>
        
        <p><strong>{% trans "Note:" %}</strong> {% trans "The system will look for cells containing 'completed' followed by a date to mark modules as completed." %}</p>
        
        <div style="margin-top: 20px;">
            <a href="{% url 'admin:courses_moduleprogress_export_template' %}" class="button">ðŸ“¤ {% trans "Download Template" %}</a>
        </div>
    </div>
</div>
{% endblock %}