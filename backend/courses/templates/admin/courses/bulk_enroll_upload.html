{% extends "admin/base_site.html" %}
{% load i18n %}

{% block content %}
<div id="content-main">
    <h1>{% trans "Bulk Enroll Users" %}</h1>
    
    {% if request.session.bulk_operation_errors %}
    <div class="errornote">
        <h3>{% trans "Errors occurred during processing:" %}</h3>
        <ul>
            {% for error in request.session.bulk_operation_errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div class="module">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="form-row">
                <label for="course_id">{% trans "Select Course:" %}</label>
                <select name="course_id" id="course_id" required>
                    <option value="">{% trans "Select a course" %}</option>
                    {% for course in courses %}
                    <option value="{{ course.id }}" {% if request.GET.course_id == course.id|stringformat:"s" %}selected{% endif %}>
                        {{ course.title }}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-row">
                <label for="excel_file">{% trans "Excel File:" %}</label>
                <input type="file" name="excel_file" accept=".xlsx, .xls" required>
                <p class="help">{% trans "Upload an Excel file with columns: user_email, user_id" %}</p>
            </div>

            <div class="submit-row">
                <input type="submit" value="{% trans 'Process Enrollment' %}" class="default">
                <a href="{% url 'admin:courses_course_changelist' %}" class="button">{% trans 'Cancel' %}</a>
            </div>
        </form>
    </div>

    <div class="module">
        <h2>{% trans "Template Format" %}</h2>
        <p>{% trans "Download the template file to see the required format. Your Excel file should have these columns:" %}</p>
        <table>
            <thead>
                <tr>
                    <th>{% trans "Column" %}</th>
                    <th>{% trans "Description" %}</th>
                    <th>{% trans "Required" %}</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>user_email</code></td>
                    <td>{% trans "User's email address" %}</td>
                    <td>{% trans "Yes (if user_id not provided)" %}</td>
                </tr>
                <tr>
                    <td><code>user_id</code></td>
                    <td>{% trans "User's UUID" %}</td>
                    <td>{% trans "Yes (if email not provided)" %}</td>
                </tr>
            </tbody>
        </table>
        
        <div style="margin-top: 20px;">
            <a href="{% url 'admin:courses_course_export_template' %}" class="button">ðŸ“¤ {% trans "Download Template" %}</a>
        </div>
    </div>
</div>
{% endblock %}